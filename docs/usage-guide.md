# InfoBattle 实战手册

## 主持人 3 步走
1. **导人**：登录 `/admin`（向主持人索取后台口令，系统会跳过学号后四位为 `0000` 的记录），在“批量导入玩家”粘贴 `学号 姓名`，点“导入/追加”。  
2. **开局**：确认人数 ≥3，选场景（留空自动均衡），并可选择一张“挑战卡”（或留空交由系统随机）；点“开启信息战”。系统会记录已体验过钓鱼大师/城市领袖的同学，自动轮换。  
3. **控场**：  
   - Drafting：提醒钓鱼大师/城市领袖 5 分钟内提交草稿。  
   - Judging：两封邮件都提交后，点“进入判断阶段”。市民完成判断后点“切换到复盘”。  
   - Retro/Completed：复盘完点“结束本回合”，此时才可开启下一轮。  
   - 控制台实时展示：场景背景、模板列表、草稿进度、判断统计、角色覆盖率、分发日志、排行榜、高级统计、钓鱼流程日志导出（情景配置/完整报告/流程 JSON）。

## 角色要点
- **钓鱼大师 `/phisher`**  
  1. 在左侧模板库挑选钓鱼模版或自行撰写。  
  2. 根据挑战卡提示设计话术，编辑主题 / 纯文本正文 / HTML 内容、发件人别名、Reply-To、附件占位。  
  3. 选择收件人策略：广播 / 按角色群组 / 定向单播。  
  4. 提交后可在面板查看市民判断，迷惑成功每人 +2 分。
- **城市领袖 `/leader`**  
  - 流程同钓鱼大师，需结合挑战卡的防御要点引用法规、强调官方域名，提醒市民核验。市民“可信”则 +2 分。
- **普通市民 `/citizen`**  
  - 仿邮箱视图：左侧收件列表、右侧 HTML 正文。顶部展示场景线索与挑战卡情报，支持查看附件占位、记录判断依据。  
  - 针对每封邮件单独点击“可信 / 存疑”，仅在 Judging/Retro 阶段可用。识别真实或钓鱼各 +1 分。

## 评分 & 胜负
- 钓鱼大师 / 城市领袖：每位市民被说服 +2 分。  
- 普通市民：识别真实或识别钓鱼各 +1 分。  
- `GET /statistics` 或后台“赛后排行榜”可随时宣布名次、发放奖励。

## 本地部署
```bash
pnpm install
pnpm run dev:server   # API + SQLite
pnpm run dev          # 前端
```
数据库位于 `server/data/infobattle.sqlite3`。主持人可直接在后台“重置数据库”清空玩家/回合；如需手动处理，删除该文件并重启即可。

## 常见问题
- **无法进入判断阶段**：确认两封草稿都已提交。  
- **无法进入复盘**：至少需要一条市民判断。  
- **无法开启下一轮**：上一轮必须标记为 Completed。  
- **玩家忘记角色**：在管理员页面“角色覆盖情况”中可查。
